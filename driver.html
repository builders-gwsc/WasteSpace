<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Griffin Waste – Driver</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <!-- HEADER -->
  <header class="app-header">
    <img src="assets/logo.png" alt="Griffin Waste Logo" class="logo"/>
    <h1>Driver Portal</h1>
    <button id="logoutBtn" class="logout-btn">Logout</button>
  </header>

  <!-- DRIVER NAVIGATION -->
  <nav class="hub-nav">
    <button onclick="location.href='hub.html'" class="nav-btn">🏠 Hub</button>
    <button onclick="alert('Daily Route Map coming soon!')" class="nav-btn">🗺️ Route</button>
  </nav>

  <!-- ASSIGNMENTS -->
  <section>
    <h2>My Assignments</h2>
    <ul id="assignmentList"></ul>
  </section>

  <script type="module">
    import { auth, db } from "./js/config.js";
    import { logout } from "./js/auth.js";
    import {
      collection, query, onSnapshot, where
    } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

    document.getElementById("logoutBtn").addEventListener("click", logout);

    // Only show assignments for THIS driver
    auth.onAuthStateChanged((user) => {
      if (!user) return;

      const driverName = user.displayName || user.email;
      const q = query(collection(db, "assignments"), where("driver", "==", driverName));

      onSnapshot(q, (snapshot) => {
        const assignmentList = document.getElementById("assignmentList");
        assignmentList.innerHTML = "";
        snapshot.forEach((doc) => {
          const d = doc.data();
          const li = document.createElement("li");
          li.textContent = `${d.customer} – ${d.task} (${d.category}) @ ${d.address} [${d.status}]`;
          assignmentList.appendChild(li);
        });
      });
    });
  </script>
</body>
</html>
